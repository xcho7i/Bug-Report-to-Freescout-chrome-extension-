<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bug Reporter</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      width: 510px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z" fill="currentColor"/>
        </svg>
        <h1>Bug Reporter</h1>
      </div>
      <button class="settings-btn" id="settingsBtn" title="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19.14 12.94C19.18 12.64 19.2 12.33 19.2 12C19.2 11.68 19.18 11.36 19.13 11.06L21.16 9.48C21.34 9.34 21.39 9.07 21.28 8.87L19.36 5.55C19.24 5.33 18.99 5.26 18.77 5.33L16.38 6.29C15.88 5.91 15.35 5.59 14.76 5.35L14.4 2.81C14.36 2.57 14.16 2.4 13.92 2.4H10.08C9.84 2.4 9.65 2.57 9.61 2.81L9.25 5.35C8.66 5.59 8.12 5.92 7.63 6.29L5.24 5.33C5.02 5.25 4.77 5.33 4.65 5.55L2.74 8.87C2.62 9.08 2.66 9.34 2.86 9.48L4.89 11.06C4.84 11.36 4.8 11.69 4.8 12C4.8 12.31 4.82 12.64 4.87 12.94L2.84 14.52C2.66 14.66 2.61 14.93 2.72 15.13L4.64 18.45C4.76 18.67 5.01 18.74 5.23 18.67L7.62 17.71C8.12 18.09 8.65 18.41 9.24 18.65L9.6 21.19C9.65 21.43 9.84 21.6 10.08 21.6H13.92C14.16 21.6 14.36 21.43 14.39 21.19L14.75 18.65C15.34 18.41 15.88 18.09 16.37 17.71L18.76 18.67C18.98 18.75 19.23 18.67 19.35 18.45L21.27 15.13C21.39 14.91 21.34 14.66 21.15 14.52L19.14 12.94ZM12 15.6C10.02 15.6 8.4 13.98 8.4 12C8.4 10.02 10.02 8.4 12 8.4C13.98 8.4 15.6 10.02 15.6 12C15.6 13.98 13.98 15.6 12 15.6Z" fill="currentColor"/>
        </svg>
      </button>
    </header>

    <!-- Main Content -->
    <div id="mainView" class="main-view">
      <!-- Capture Options -->
      <div class="capture-section">
        <h2>Capture Bug</h2>
        <div class="button-group" style="display: flex; flex-direction: column; gap: 10px; justify-content: center; align-items: center;">
          <button class="btn btn-primary" style="width: 300px;" id="screenshotBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19ZM8.5 13.5L11 16.51L14.5 12L19 18H5L8.5 13.5Z" fill="currentColor"/>
            </svg>
            <span>Screenshot</span>
          </button>
          <button class="btn btn-secondary" style="width: 300px;" id="recordBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 10.5V7C17 6.45 16.55 6 16 6H4C3.45 6 3 6.45 3 7V17C3 17.55 3.45 18 4 18H16C16.55 18 17 17.55 17 17V13.5L21 17.5V6.5L17 10.5Z" fill="currentColor"/>
            </svg>
            <span>Record Video</span>
          </button>
          <button class="btn btn-outline" id="attachBtn" style="width: 300px;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16.5 6.5L7.5 15.5C6.67 16.33 6.67 17.67 7.5 18.5C8.33 19.33 9.67 19.33 10.5 18.5L18 11C19.66 9.34 19.66 6.66 18 5C16.34 3.34 13.66 3.34 12 5L4.5 12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Attach Files</span>
          </button>
          <input type="file" id="attachInput" class="hidden" />
        </div>
      </div>

      <!-- Recording Controls (Hidden initially) -->
      <div id="recordingControls" class="recording-controls hidden">
        <div class="recording-status">
          <div class="recording-indicator">
            <span class="pulse"></span>
            <span class="recording-text">Recording</span>
          </div>
          <div class="timer" id="timer">00:00</div>
        </div>
        <button class="btn btn-danger" id="stopRecordBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="6" width="12" height="12" fill="currentColor"/>
          </svg>
          <span>Stop Recording</span>
        </button>
      </div>

      <!-- Floating Stop Button (visible during recording) -->
      <div id="floatingStop" class="floating-stop hidden">
        <button class="btn btn-danger" id="floatingStopBtn" title="Stop Recording">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="6" y="6" width="12" height="12" fill="currentColor"/>
          </svg>
        </button>
      </div>

      <!-- Preview Section (Hidden initially) -->
      <div id="previewSection" class="preview-section hidden">
        <h2 id="previewTitle">Preview</h2>
        <div class="preview-container" id="previewContainer">
          <!-- Screenshot or video preview will be inserted here -->
        </div>
        
        <!-- Attachments Block (for file-only submissions or extra files) -->
        <div id="attachmentsBlock" class="attachments-section hidden">
          <div class="attachments-header">
            <h3>Attachments</h3>
            <button class="btn btn-outline" id="addMoreFilesBtn">Add file</button>
          </div>
          <small>Accepted: images, videos, PDFs, docs. Max 50 MB per file.</small>
          <div id="fileList" class="file-list"></div>
        </div>

        <!-- Annotation Toolbar (shown for screenshots) -->
        <div id="annotateToolbar" class="annotate-toolbar hidden">
          <div class="annotate-row">
            <button class="btn btn-outline" id="toggleDrawBtn" title="Toggle draw">Draw</button>
            <label class="annotate-field">
              <span>Color</span>
              <input type="color" id="brushColor" value="#ef4444" />
            </label>
            <label class="annotate-field">
              <span>Size</span>
              <input type="range" id="brushSize" min="2" max="16" value="4" />
            </label>
            <button class="btn btn-outline" id="undoDrawBtn" title="Undo">Undo</button>
            <button class="btn btn-outline" id="clearDrawBtn" title="Clear">Clear</button>
          </div>
        </div>
        
        <!-- Notes Section -->
        <div class="notes-section">
          <div class="form-group">
            <label for="bugNotes">Describe the bug:</label>
            <textarea id="bugNotes" placeholder="Enter bug description, steps to reproduce, expected vs actual behavior, etc..." rows="3"></textarea>
          </div>
          
          <!-- Additional fields -->
          <div class="form-group">
            <label for="bugTitle">Bug Title:</label>
            <input type="text" id="bugTitle" placeholder="Brief summary of the bug" />
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="bugPriority">Priority:</label>
              <select id="bugPriority">
                <option value="3">Low</option>
                <option value="2" selected>Medium</option>
                <option value="1">High</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="bugType">Type:</label>
              <select id="bugType">
                <option value="bug" selected>Bug</option>
                <option value="feature">Feature Request</option>
                <option value="improvement">Improvement</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-outline" id="cancelBtn">
            <span>Cancel</span>
          </button>
          <button class="btn btn-success" id="submitBtn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
            </svg>
            <span>Submit Bug Report</span>
          </button>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="loading-state hidden">
        <div class="spinner"></div>
        <p>Submitting bug report...</p>
      </div>

      <!-- Success State -->
      <div id="successState" class="success-state hidden">
        <div class="success-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z" fill="currentColor"/>
          </svg>
        </div>
        <h2>Bug Report Submitted!</h2>
        <p>Your bug report has been successfully sent to FreeScout.</p>
        <button class="btn btn-primary" id="newReportBtn">Create New Report</button>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settingsView" class="settings-view hidden">
      <div class="settings-header">
        <button class="back-btn" id="backBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 11H7.83L13.42 5.41L12 4L4 12L12 20L13.41 18.59L7.83 13H20V11Z" fill="currentColor"/>
          </svg>
        </button>
        <h2>Settings</h2>
      </div>

      <div class="settings-content">
        <div class="form-group">
          <label for="freescoutUrl">FreeScout URL:</label>
          <input type="url" id="freescoutUrl" placeholder="https://your-freescout-domain.com" />
          <small>Your FreeScout installation URL</small>
        </div>

        <div class="form-group">
          <label for="apiKey">API Key:</label>
          <input type="password" id="apiKey" placeholder="Enter your FreeScout API key" />
          <small>Get this from FreeScout Settings → API</small>
        </div>

        <div class="form-group">
          <label for="mailboxId">Mailbox ID:</label>
          <input type="number" id="mailboxId" placeholder="1" />
          <small>The mailbox ID where bug reports will be created</small>
        </div>

        <div class="form-group">
          <label for="defaultAssignee">Default Assignee Email (Optional):</label>
          <input type="email" id="defaultAssignee" placeholder="developer@example.com" />
          <small>Automatically assign bug reports to this user</small>
        </div>

        <div class="form-group">
          <label>Recording Settings:</label>
          <div class="checkbox-group">
            <label>
              <input type="checkbox" id="recordAudio" checked />
              <span>Record microphone audio</span>
            </label>
            <label>
              <input type="checkbox" id="recordSystemAudio" />
              <span>Record system audio (if available)</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="maxRecordingTime">Max Recording Time (seconds):</label>
          <input type="number" id="maxRecordingTime" value="30" min="5" max="60" />
          <small>Maximum: 60 seconds</small>
        </div>

        <div class="form-group">
          <label for="videoQuality">Video Quality:</label>
          <select id="videoQuality">
            <option value="low">Low (faster upload)</option>
            <option value="medium" selected>Medium (balanced)</option>
            <option value="high">High (best quality)</option>
          </select>
        </div>

        <button class="btn btn-primary btn-block" id="saveSettingsBtn">
          <span>Save Settings</span>
        </button>

        <div class="settings-info">
          <h3>How to get your API credentials:</h3>
          <ol>
            <li>Log into your FreeScout admin panel</li>
            <li>Go to <strong>Manage → Settings → API</strong></li>
            <li>Generate a new API key</li>
            <li>Find your Mailbox ID in <strong>Manage → Mailboxes</strong></li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <script src="freescout-api.js"></script>
  <script src="popup.js"></script>
</body>
</html>

